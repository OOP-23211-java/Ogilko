<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Аутентификация</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #auth-container { width: 300px; }
        input, button { width: 100%; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
<div id="auth-container">
    <h2 id="form-title">Вход</h2>
    <form id="auth-form">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Пароль" required>
        <button type="submit">Войти</button>
    </form>
    <p id="switch-form">
        Нет аккаунта? <a href="#" onclick="toggleForm()">Зарегистрироваться</a>
    </p>
</div>

<script>
    let isLogin = true;

    function toggleForm() {
        isLogin = !isLogin;
        document.getElementById('form-title').innerText = isLogin ? 'Вход' : 'Регистрация';
        document.querySelector('#auth-form button').innerText = isLogin ? 'Войти' : 'Зарегистрироваться';
        document.getElementById('switch-form').innerHTML = isLogin
            ? 'Нет аккаунта? <a href="#" onclick="toggleForm()">Зарегистрироваться</a>'
            : 'Уже есть аккаунт? <a href="#" onclick="toggleForm()">Войти</a>';
    }

    document.getElementById('auth-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (!isLogin) {
            // регистрация
            const resp = await fetch('/api/auth/signup', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email, password})
            });
            if (resp.ok) {
                alert('Регистрация успешна! Войдите.');
                toggleForm();
            } else {
                alert('Ошибка регистрации: ' + resp.status);
            }
        } else {
            // вход
            const formData = new URLSearchParams();
            formData.append('username', email);
            formData.append('password', password);

            const resp = await fetch('/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: formData
            });
            if (resp.ok) {
                // переходим на главную
                window.location.href = '/main.html';
            } else {
                alert('Ошибка входа: ' + resp.status);
            }
        }
    });
</script>
</body>
</html>
