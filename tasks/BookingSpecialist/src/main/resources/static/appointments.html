<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мои записи</title>
    <style>
        body { font-family: sans-serif; padding: 40px; max-width: 800px; margin: auto; }
        .appointment { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 6px; }
        button { margin-top: 10px; }
        #back { margin-top: 20px; }
    </style>
</head>
<body>
<h1>Мои записи</h1>
<div id="list">Загрузка...</div>
<button id="back" onclick="location.href='main.html'">Назад</button>

<script>
    async function loadAppointments() {
        const resp = await fetch('/api/appointments');
        if (!resp.ok) return alert("Ошибка при загрузке записей");

        const appointments = await resp.json();
        const container = document.getElementById('list');
        container.innerHTML = '';

        if (appointments.length === 0) {
            container.innerText = 'У вас нет записей.';
            return;
        }

        appointments.forEach(a => {
            const el = document.createElement('div');
            el.className = 'appointment';

            const dateTime = new Date(a.appointmentTime).toLocaleString();

            el.innerHTML = `
          <b>Специалист:</b> ${a.specialist.name}<br>
          <b>Профессия:</b> ${a.specialist.profession}<br>
          <b>Время:</b> ${dateTime}<br>
          <button onclick="cancelAppointment(${a.id})">Отменить запись</button>
        `;

            container.appendChild(el);
        });
    }

    async function cancelAppointment(id) {
        if (!confirm('Отменить эту запись?')) return;

        const resp = await fetch('/api/appointments/' + id, { method: 'DELETE' });
        if (resp.ok) {
            alert('Запись отменена');
            loadAppointments();
        } else {
            alert('Ошибка при отмене: ' + resp.status);
        }
    }

    loadAppointments();
</script>
</body>
</html>
